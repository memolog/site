<!doctype html>
<html lang="ja">
<head>
  <title>Date.parseとタイムゾーン | メモログ</title>
    <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="/assets/icons/icon-32.ico">
  <style>body {
  background-color: white;
  color: black;
  font-family: 'Hiragino Kaku Gothic Pro',  YuGothic, 'Yu Gothic', sans-serif;
  margin: 0;
  padding: 0;
}

a {
  color: darkred;
}

a:visited {
  color: rebeccapurple;
}

.header {
  margin: 0 auto;
  font-family: Garamond, 'Times New Roman', serif; }

.header_component_global {
  text-align: center;
  margin: 1em 0;
}

.header__title {
  display: inline-block;
  background-color: #f5f2f0;
  margin: .2em 0 .2em;
  padding: 5px;
  font-size: 1.8em;
  font-weight: normal;
  vertical-align: bottom;
}

.header__title a {
  color: black;
  text-decoration: none;
}

.header_component_global .header__title {
  font-size: 1.2em;
}

.header_component_global .header__title a {
  text-decoration: none;
  color: black;
}

.main .header .header__title {
  position: sticky;
  top: 10px;
  z-index: 100;
  opacity: .8;
  margin-bottom: 0;
}

.header__description {
  margin-top: 0;
  margin-bottom: 1em; }

.header_component_global .header__description {
  color: #666;
  margin: 0 auto;
  padding: 0 5px; }

.header__epigraph {
  font-style: italic;
  color: #666;
  margin: 0 auto;
  padding: 5px; }

.container {
  max-width: 900px;
  margin: 0 auto 4em;
  padding: 0 15px;
  border-radius: 3px;
}

.content {
  font-size: 1.1em;
  line-height: 2em;
  color: #444;
  -webkit-font-smoothing: antialiased;
}

.content h2,
.content h3 {
  font-size: 1.4em;
  margin: 2em 0 0 0;
  border-bottom: 1px solid #ddd;
}

.article-summary {
  margin-bottom: 3.5em;
}

.header time {
  display: inline-block;
  font-size: .9125em;
  color: #666;
}

.calendar-icon, .author-icon {
  margin-right: .5em;
}

.content blockquote {
  border: 5px solid #ddd;
  background: #f9f9f9;
  margin: 1.5em 1em;
  padding: 0 1em;
}

.content p > code,
.content li > code {
  background-color: #f5f2f0;
  display: inline-block;
  padding: 0 6px;
  border-radius: .3em;
  color:#444;
}

.content code[class*="language-"] {
  color: #444;
}

@media screen and (max-width: 500px) {
  .header__epigraph {
    display: none;
  }

  .header__title {
    font-size: 1.2em;
  }

  .content h2 {
    font-size: 1.2em;
  }

  .content {
    font-size: 1em;
  }
}

.header__feature {
  margin: .5em 0 -.5em;
  position: relative;
}

.header__feature img {
  max-width: 100%;
  overflow: hidden;
}

.featured__image {
  background: white;
  line-height: 0;
  max-height: 430px;
  overflow: hidden;
}

.featured__credit {
  color: #666;
  font-size: .825em;
  text-align: right;
  margin-top: .5em;
  position: absolute;
  right: 0;
  bottom: 0;
  padding: .5em;
  background: #f0f0f0;
  opacity: .8;
}

.lazyload,
.lazyloading {
	opacity: 0.5;
}

.lazyloaded {
	opacity: 1;
	transition: opacity 2s .3s cubic-bezier(.3,.18,.15,1);
}

.content img {
  max-width: 100%;
}

.youtube-wrapper {
  position: relative;
  display: block;
  height: 0;
  padding: 0;
  overflow: hidden;
  padding-bottom: 56.25%;
}

.youtube-wrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  height: 100%;
  width: 100%;
  border: 0;
}

@media screen and (max-width: 900px) {
  .featured__image,
  .content__image,
  .content pre[class*="language-"],
  .youtube-wrapper {
    margin: 0 -15px;
  }
}

@media screen and (max-width: 900px) {
  .featured__image,
  .content__image,
  .content pre[class*="language-"] {
    margin: 0 -15px;
  }
}

.link-icon {
  background-position-x: 4px;
  background-position-y: center;
  background-repeat: no-repeat;
  padding-left: 24px;
}

.post .writing-vertical {
  writing-mode: vertical-rl;
  font-family: serif;
  font-size: 1em;
  margin: 1.5em 0;
  column-count: 2;
  max-width: 900px;
  width: 102%;
  overflow: auto;
  height: 800px;
}

.post .writing-vertical p {
  margin: 0;
}

.post .writing-vertical p a {
  padding-left: 0px;
  padding-top: 24px;
}

.post .writing-vertical p:first-letter {
  margin-top: 1em;
}

.post .writing-vertical .link-icon {
  background-position-x: center;
  background-position-y: 5px;
}

.post .writing-vertical blockquote {
  border: none;
  margin: 0 .5em;
  padding: 1em .5em;
  background: #f0f0f0;
}

@media screen and (max-width: 930px) {
  .post .writing-vertical {
    margin-left: 0;
    margin-right: 0;
    width: 100%;
  }
}
</style>
  <script>window.lazyLoadOptions = {};</script>
  <link rel="preload" as="style" href="/css/global_async.css" onload="this.rel='stylesheet'">
  <link rel="alternate" href="http://feeds.feedburner.com/jp/memolog" title="Latest Articles">
  <link rel="manifest" href="/manifest.json" >
  <meta name="theme-color" content="white">

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-955153-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-955153-2');
  </script>
  <script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@graph":
    [
      {
        "@context": "http://schema.org",
        "@type": "Organization",
        "url": "http://memolog.org",
        "logo": "https://memolog.org/assets/icons/icon-1024.png"
      },
      {
        "@context": "http://schema.org",
        "@type": "Person",
        "name": "Yutaka Yamaguchi",
        "url": "http://memolog.org",
        "sameAs": [
          "https://www.facebook.com/yutaka.yamaguchi",
          "https://www.linkedin.com/in/yutakayamaguchi/",
          "https://twitter.com/memolog"
        ]
      }
    ]
  }
  </script>

  <meta name="description" content="Date.parse(‘1999-07-07’)を実行すると、値は931305600000とUTCのタイムゾーンで解釈されるのに対して、Date.parse(‘1999/07/07’)を実行すると、値は931273200000とJSTのタイムゾーンで解釈される。あ、ローカルの時間がJSTの場合。現時点（Firefox 24、Chrome 31）">
<meta name="keywords" content="javascript">
<meta property="og:type" content="article">
<meta property="og:title" content="Date.parseとタイムゾーン">
<meta property="og:url" content="https://memolog.org/2013/10/date_parse_and_timzone.html">
<meta property="og:site_name" content="メモログ">
<meta property="og:description" content="Date.parse(‘1999-07-07’)を実行すると、値は931305600000とUTCのタイムゾーンで解釈されるのに対して、Date.parse(‘1999/07/07’)を実行すると、値は931273200000とJSTのタイムゾーンで解釈される。あ、ローカルの時間がJSTの場合。現時点（Firefox 24、Chrome 31）">
<meta property="og:locale" content="ja">
<meta property="og:updated_time" content="2019-01-04T02:09:12.870Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Date.parseとタイムゾーン">
<meta name="twitter:description" content="Date.parse(‘1999-07-07’)を実行すると、値は931305600000とUTCのタイムゾーンで解釈されるのに対して、Date.parse(‘1999/07/07’)を実行すると、値は931273200000とJSTのタイムゾーンで解釈される。あ、ローカルの時間がJSTの場合。現時点（Firefox 24、Chrome 31）">
<meta name="twitter:creator" content="@memolog">
<meta name="twitter:site" content="https://twitter.com/memolog">
<meta property="fb:app_id" content="168245123786587">
  <link rel="canonical" href="https://memolog.org/2013/10/date_parse_and_timzone.html">
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "BlogPosting",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://memolog.org/2013/10/date_parse_and_timzone.html"
      },
      "headline": "Date.parseとタイムゾーン",
      
      "datePublished": "Sun Oct 06 2013 09:50:00 GMT+0900",
      "dateModified": "Fri Jan 04 2019 11:09:12 GMT+0900",
      "author": {
        "@type": "Person",
        "name": "Yutaka Yamaguchi"
      },
      "publisher": {
        "@type": "Organization",
        "name": "メモログ",
        "logo": {
          "@type": "ImageObject",
          "url": "https://memolog.org/assets/icons/icon-1024.png"
        }
      },
      "description": "Date.parse(‘1999-07-07’)を実行すると、値は931305600000とUTCのタイムゾーンで解釈されるのに対して、Date.parse(‘1999/07/07’)を実行すると、値は931273200000とJSTのタイムゾーンで解釈される。あ、ローカルの時間がJSTの場合。現時点（Firefox 24、Chrome 31）"
    }
  </script>
</head>
<body class="post">
    <header class="header header_component_global">
    <div class="header__icon" aria-hidden="true"><img src="/assets/icons/icon.svg" role="presentation" width="48" height="48" alt="icon"></div>
    <h1 class="header__title header__title"><a href="/">メモログ</a></h1>
    <p class="header__description">💡 Personal notes about anything I&#39;m interested in</p>
    <aside aria-hidden="true"><blockquote class="header__epigraph">Well, he fuffed, and he puffed, and he huffed and he puffed, and he puffed and huffed; but he could not get the house down.</blockquote></aside>
    <nav class="navigation navigation-global">
      <a href="/" class="navigation__link">📘 Latest Articles</a>
    </nav>
  </header>

  <div class="container">
    <main class="main">
      <article>
        <header class="header">
          <div>
            <time datetime="2013-10-06T00:50:00.000Z">
              <span class="calendar-icon">📅</span><span>2013年10月6日</span>
            </time>
          </div>
          <h2 class="header__title">Date.parseとタイムゾーン</h2>
          
        </header>
        <div id="article-content" class="content "><p>Date.parse(‘1999-07-07’)を実行すると、値は931305600000とUTCのタイムゾーンで解釈されるのに対して、Date.parse(‘1999/07/07’)を実行すると、値は931273200000とJSTのタイムゾーンで解釈される。あ、ローカルの時間がJSTの場合。現時点（Firefox 24、Chrome 31）</p>
<a id="more"></a>
<p><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Date/parse?redirectlocale=ja&amp;redirectslug=JavaScript&#x25;2FReference&#x25;2FGlobal_Objects&#x25;2FDate&#x25;2Fparse" target="_blank" rel="noopener">Date.parse</a>では引数に与えられた文字列をパースして、ミリ秒の値を値を返してくれます。タイムゾーンの指定がない場合はローカルのタイムゾーンとして解釈される。<a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm" target="_blank" rel="noopener">ECMA-262</a>では、以下のように説明されています（太字は私がつけた）。</p>
<blockquote>
<p>15.9.4.2 Date.parse (string)</p>
<p>The parse function applies the ToString operator to its argument and interprets the resulting String as a date and time; it returns a Number, the UTC time value corresponding to the date and time. <strong>The String may be interpreted as a local time</strong>, a UTC time, or a time in some other time zone, depending on the contents of the String.</p>
</blockquote>
<p>つまり、Date.parse(‘1999/07/07’)ではタイムゾーンの指定がないので、ローカルのタイムゾーンの日時として解釈される。Date.parse(‘1999-07-07’)の場合はなぜUTCになるか。ECMA-262は以下のように続く。</p>
<blockquote>
<p><strong>The function first attempts to parse the format of the String according to the rules called out in Date Time String Format (15.9.1.15).</strong> If the String does not conform to that format the function may fall back to any implementation-specific heuristics or implementation-specific date formats. Unrecognisable Strings or dates containing illegal element values in the format String shall cause Date.parse to return NaN.</p>
</blockquote>
<p>Date Time String Formatについては、下記のように書かれている。</p>
<blockquote>
<p>15.9.1.15 Date Time String Format</p>
<p>ECMAScript defines a string interchange format for date-times based upon a simplification of the ISO 8601 Extended Format. The format is as follows: YYYY-MM-DDTHH:mm:ss.sssZ</p>
</blockquote>
<p>つまり、Date.parseで渡された引数は、最初にISO8601の書式に従って解釈して、ISO8601に合わない場合はブラウザの実装されている解釈に委ねられる。</p>
<p>なので、Date.parse(‘1999-07-07’)の場合はISO8601の書式として解釈される（ISO8601の書式に一致する）。そしてISO8601の書式においては、タイムゾーンの指定がない場合はUTCのタイムゾーンとなる。雰囲気。</p>
<blockquote>
<p>All numbers must be base 10. If the MM or DD fields are absent 01 is used as the value. If the HH, mm, or ss fields are absent 00 is used as the value and the value of an absent sss field is 000. <strong>The value of an absent time zone offset is Z.</strong></p>
</blockquote>
<p>しかし、<a href="http://en.wikipedia.org/wiki/ISO_8601#Time_zone_designators" target="_blank" rel="noopener">WikipediaのISO8601のtime zoneの記述</a>を読むと、UTCに関連する情報がない場合は、時間はローカルタイムと仮定されると記されている。</p>
<blockquote>
<p>Time zone designators</p>
<p>Time zones in ISO 8601 are represented as local time (with the location unspecified), as UTC, or as an offset from UTC.</p>
<p><strong>If no UTC relation information is given with a time representation, the time is assumed to be in local time.</strong> While it may be safe to assume local time when communicating in the same time zone, it is ambiguous when used in communicating across different time zones. It is usually preferable to indicate a time zone (zone designator) using the standard’s notation.</p>
</blockquote>
<p>うーん… どっちなのか。現時点のブラウザの実装的にはUTCになるわけですけど。</p>
<p>とにかく。まあ、だから、Date.parseで日本時間として解釈したい場合はDate.parse(‘1999-07-07T00:00:00+09:00’)というように、タイムゾーンを明示的に指定した方が良い。Date.parse(‘1999/07/07’)の方がスッキリして良いのですけど、こちらはブラウザの実装次第であるので、解釈できずにNaNになる可能性があるし、Future proofという観点からもやはりISO8601で指定する方が良い（’1999/07/07’はどのブラウザでも大丈夫だけど）。</p>
<p>しかし、IE8はISO8601の書式には対応していない… Date.parse(‘1999-07-07’)はNaNになる。なので、別途対応する必要がある。そのあたり<a href="http://momentjs.com/docs/#/parsing/string/" target="_blank" rel="noopener">Moment.js</a>ではクロスブラウザに対応しているので便利。Moment.jsはそれ以外にもいろいろ便利。ただ、Moment.jsでmoment(‘1999-07-07’)とすると、Timezoneがローカルタイムになるので注意。（<a href="https://github.com/moment/moment/issues/1167" target="_blank" rel="noopener">issue</a>にあげてみたけど、上のISO8601の内容もあってcloseになった。まあでもデフォルトでローカルタイムの方が妥当な気がする）</p>
<p>その後、より詳しい回答がついた（以下は抜粋）。詳しくは<a href="https://github.com/moment/moment/issues/1167#issuecomment-25772376" target="_blank" rel="noopener">こちら</a>。</p>
<blockquote>
<p>In reality, browsers that support the ISO format tend to follow the ES5 rule when provided an input in YYYY-MM-DD format, as long as the separator is a hyphen (-). But if the separator is a slash (/), then they usually treat that as local time. However, I don’t think it would be a good idea to have moment follow this convention.</p>
<p>One of the primary reasons for using moment (IMHO) is to have uniformity in parsing. Browser specifics and ES5 specs are not something we should aim for feature parity with. Moment is more than just a shim. One could argue that ES5 is “doing it wrong”, and that moment implements ISO8601 more precisely. Although ES5 does make it clear that theirs is a “based upon a simplification of the ISO 8601 Extended Format”, so it doesn’t have to precisely implement it.</p>
</blockquote>
<p>ISO8601とES5とのspecの違いについて、ブラウザはES5によせる傾向があると。ES5のspecが誤っていて、momentの実装の方がISO8601に対してより正確であるという見方もできると。</p>
<p>まあ、そういうわけで、パースするときに使う文字列はタイムゾーンまで含めるのが良し。</p>
<p>というメモ。</p>
</div>
        <footer class="profile">
  <div class="profile-inner">
    <div class="profile__image"><img src="/assets/icons/icon.svg" role="presentation" width="48" height="48" alt="icon"></div>
    <h2 class="profile__heading">About the Author</h2>
    <div class="profile__content">
      <div>Yutaka Yamaguchi</div>
      <div>a (front-end) engineer living in Tokyo, using TypeScript, Node.js, JavaScript, swift and perl for work, interested in WASM and Rust, studying English.</div>
      <ul class="profile__social-list">
        <li class="profile__social-list-item"><a href="https://twitter.com/memolog">Twitter</a></li>
        <li class="profile__social-list-item"><a href="https://www.linkedin.com/in/yutakayamaguchi/">LinkedIn</a></li>
        <li class="profile__social-list-item"><a href="https://www.facebook.com/yutaka.yamaguchi">Facebook</a></li>
      </ul>
    </div>
  </div>
</footer>

      </article>
    </main>
  </div>
  <script src="/js/lazysizes/lazysizes.min.js" async></script>
<script>
  // http://css-tricks.com/favicons-next-to-external-links/
  (function (){
    'use strict';
    if (/googlebot/i.test(navigator.userAgent)) {
      return;
    }
    const links = document.querySelectorAll('.content p a');
    const linkLength = links && links.length || 0;
    for (var i=0; i<linkLength; i++){
      const link = links[i];
      const hostname = link.hostname;
      if (hostname) {
        const children = link.children || [];
        const firstChild = children && children[0];
        if (firstChild && firstChild.tagName === 'IMG') {
          // For old amazon image link
          if (link.hostname === 'www.amazon.co.jp') {
            link.style.float = 'left';
            link.style.marginRight = '1em';
            link.style.paddingLeft = '0';
          }
          continue;
        }

        link.classList.add('link-icon');
        link.style.backgroundImage = `url(https://www.google.com/s2/favicons?domain=${hostname})`;
      }
    }
  })();
</script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js');
  }
</script>

</body>
</html>
